1、分布式锁解决方案

① 采用数据库（不建议）

② 基于Redis实现分布式锁(setnx)。【存在缺陷】

setnx也可以存入key：如果存入key成功，那么返回1；
如果存入key失败，那么返回0，表示要存入的key已经存在了。

③ 基于Zookeeper实现分布式锁。（推荐）

原理：当多个客户端（这里的客户端就是指多个JVM）同时在zookeeper上
创建相同的一个临时节点，因为临时节点的路径是保证唯一的，
只要哪个客户端(JVM)能够创建节点成功，谁就能获取到锁，没有创建
成功的客户端(或者是集群中的节点)，就会进行等待；当释放锁的时候，
采用事件通知给客户端重新获取锁的资源。

Zookeeper介绍：

Zookeeper是一个分布式协调工具，用在分布式解决方案中。

例如：分布式锁、分布式配置中心、 消息中间件、注册中心等等，
zookeeper在分布式领域应用是非常多的。


2、实现分布式锁核心思路

在多台服务器集群中，只能够保证一个JVM进行做操作。

----------------------------------------------------------

实现分布式锁，zookeeper与redis异同：

1、相同点（实现分布式锁最终是通过什么方式？）
在集群环境下，保证只允许有一个JVM进行执行。


2、区别

2.1 从技术上分析
Redis是no sql数据库，主要特点是缓存
zookeeper是分布式协调工具，主要用于分布式解决方案


2.2 实现思路上分析

2.2.1 获取锁
① zookeeper获取锁的方式：多个客户端JVM，会在zookeeper上创建同一个临时节点，因为
zookeeper节点命名路径保证唯一，不允许出现重复，只要谁能够先创建成功，谁就能够获
得到锁。
② Redis获取锁的方式：多个客户端JVM，会使用redis命令setnx创建相同的一个key，因为
Redis的Key保证唯一，不允许出现重复，只要谁能够先创建成功，谁就能够获取到锁。

2.2.2 释放锁
① zookeeper释放锁的方式：zk直接关闭临时节点的session会话连接，因为临时节点的生命
周期与session会话绑定在一起，如果session会话连接关闭的话，该临时节点也会被删除。
这时候其他客户端使用事件监听，如果该临时节点被删除的话，重新进入到获取锁的步骤。
② redis释放锁的方式：Redis在释放锁的时候，为了确保锁的一致性问题，在删除key的时候，
需要判断是同一个锁的id，才允许删除。

2.2.3 如何解决死锁现象的问题
① zookeeper 通过 会话有效期方式 解决死锁
② Redis 是 对key设置缓存有效期，从而解决死锁

2.2.4 从性能方面对比
Redis比zookeeper性能更好，因为redis是no sql数据库。

2.2.5 从可靠性方面对比
Zookeeper可靠性比Redis更好，因为Redis缓存有效期不是很方便控制，可能会产生有效期延迟；
而zookeeper就不一样，因为zookeeper临时节点先天性可控的有效期，所以相对来说zookeeper比
Redis更好。

-------------------------------------------------------

Redisson简介
https://www.jianshu.com/p/8853b34f7c8b

Redisson 其实就是Redis的另外一套客户端API，相当于Jedis，也可用于实现分布式锁。
值的一提的是，Redis+lua脚本 可以支持Redis集群事务。

而Redis本身是不支持集群事务的，但集群中的每个节点是支持redis事务的。






